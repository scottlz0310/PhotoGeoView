# PhotoGeoView 品質向上ロードマップ

> 最終更新: 2025-11-16
>
> **目標**: Pythonプロジェクト同等の品質基準を達成
> - 80% テストカバレッジ
> - TypeScript strict mode
> - セキュリティチェック通過
> - CI/CD オールグリーン

## 📊 現状

### ✅ 達成済み (2025-11-16)

- [x] Biome linter セットアップ & 全ファイルパス
- [x] TypeScript type check パス
- [x] 基本的なCI/CDパイプライン (lint, typecheck, test, build)
- [x] Vitest セットアップ
- [x] 基本的なユニットテスト
  - [x] Utils (100%)
  - [x] AppStore (97.69%)
  - [x] IPC型定義 (100%)
  - [x] カスタムフック (100%)
  - [x] QueryClient (100%)
- [x] カバレッジレポート設定
- [x] **現在のカバレッジ: 20.12%**

### ⚠️ 未達成

- [ ] TypeScript strict mode 有効化
- [ ] 80% カバレッジ達成
- [ ] セキュリティチェック導入
- [ ] E2Eテスト実装
- [ ] コンポーネントテスト実装

---

## 🎯 Phase 1: TypeScript Strict Mode 移行

### 目標
TypeScriptの型安全性を最大限に活用し、ランタイムエラーを未然に防ぐ

### タスク

#### 1.1 tsconfig.json strict設定有効化
- [ ] `strict: true` 有効化を試み、エラー数を確認
- [ ] エラー箇所をリストアップ
- [ ] 段階的修正計画を立てる

#### 1.2 主要なstrict設定個別対応
- [ ] `noImplicitAny` 対応
  - [ ] main/ ディレクトリ
  - [ ] preload/ ディレクトリ
  - [ ] renderer/ ディレクトリ
- [ ] `strictNullChecks` 対応
  - [ ] Optional chaining 追加
  - [ ] Null/undefined チェック追加
- [ ] `strictFunctionTypes` 対応
- [ ] `strictBindCallApply` 対応
- [ ] `strictPropertyInitialization` 対応

#### 1.3 型定義の改善
- [ ] IPC通信の型安全性強化
- [ ] Event handler型定義の改善
- [ ] Component Props型定義の厳格化

**推定工数**: 2-3日
**優先度**: 🔴 高 (型安全性は品質の基盤)

---

## 🧪 Phase 2: テストカバレッジ 80% 達成

### 現状分析

| カテゴリ | カバレッジ | ファイル数 | 優先度 |
|---------|----------|-----------|--------|
| **コアロジック** | 97-100% | 5 | ✅ 完了 |
| **コンポーネント** | 0% | 9 | 🔴 最優先 |
| **Main Process** | 0% | 3 | 🟡 中 |
| **Preload** | 0% | 1 | 🟡 中 |

### 2.1 コンポーネントテスト (目標: +30%カバレッジ)

#### 優先度: 🔴 最優先

**ファイルブラウザ系 (コアUI)**
- [ ] `FileBrowser.tsx` テスト
  - [ ] ディレクトリ選択
  - [ ] ファイルリスト表示
  - [ ] ファイル選択
  - [ ] ナビゲーション（上へ、履歴）
- [ ] `FileList.tsx` テスト
  - [ ] ファイル一覧レンダリング
  - [ ] ソート機能
  - [ ] フィルタリング
- [ ] `FileItem.tsx` テスト
  - [ ] ファイル情報表示
  - [ ] 選択状態の切り替え
  - [ ] アイコン表示

**画像プレビュー (コアUI)**
- [ ] `ImagePreview.tsx` テスト
  - [ ] 画像読み込みと表示
  - [ ] ズーム機能
  - [ ] 回転機能
  - [ ] エラーハンドリング（画像読み込み失敗）
  - [ ] キーボードナビゲーション

**EXIF情報表示**
- [ ] `ExifPanel.tsx` テスト
  - [ ] EXIF データ表示
  - [ ] GPS情報フォーマット
  - [ ] カメラ情報表示
  - [ ] データなし時の表示

**フィルタ機能**
- [ ] `FileFilters.tsx` テスト
  - [ ] 日付範囲フィルタUI
  - [ ] GPSフィルタUI
  - [ ] カメラモデルフィルタUI
  - [ ] フィルタリセット

**地図表示**
- [ ] `PhotoMap.tsx` テスト
  - [ ] マーカー表示
  - [ ] マップ初期化
  - [ ] GPS座標からの地図中心設定
  - [ ] マーカークリックイベント

**サムネイル表示**
- [ ] `ThumbnailGrid.tsx` テスト
  - [ ] サムネイル一覧表示
  - [ ] グリッドレイアウト
  - [ ] 選択状態の反映
  - [ ] 遅延読み込み（仮想スクロール）

**推定工数**: 5-7日
**期待カバレッジ向上**: +30-35%

### 2.2 統合テスト・E2Eテスト (目標: +15%カバレッジ)

#### 優先度: 🟡 中

**Playwright E2Eテスト**
- [ ] E2E環境セットアップ
  - [ ] Playwright設定最適化
  - [ ] テストフィクスチャ作成
  - [ ] スクリーンショット比較設定
- [ ] 基本フローテスト
  - [ ] アプリ起動
  - [ ] ディレクトリ選択
  - [ ] 画像一覧表示
  - [ ] 画像選択と詳細表示
- [ ] 画像ナビゲーションテスト
  - [ ] 次/前の画像へ移動
  - [ ] 最初/最後の画像へジャンプ
  - [ ] キーボードショートカット
- [ ] フィルタリングテスト
  - [ ] 日付フィルタ適用
  - [ ] GPSフィルタ適用
  - [ ] 複合フィルタ
- [ ] EXIF表示テスト
  - [ ] GPS付き画像のEXIF表示
  - [ ] GPS無し画像の処理
  - [ ] 地図へのマーカー表示

**推定工数**: 3-4日
**期待カバレッジ向上**: +10-15%

### 2.3 Electron Main Process テスト (目標: +10%カバレッジ)

#### 優先度: 🟢 低（機能的には動作している）

**IPC Handlers**
- [ ] `fileSystem.ts` ハンドラーテスト
  - [ ] getDirectoryContents
  - [ ] getFileInfo
  - [ ] selectDirectory
  - [ ] エラーハンドリング（権限エラー、存在しないパス等）
- [ ] `imageProcessing.ts` ハンドラーテスト
  - [ ] generateThumbnail
  - [ ] readExif
  - [ ] rotateImage
  - [ ] エラーハンドリング（非画像ファイル、破損ファイル等）

**Main Process**
- [ ] `index.ts` (Electron main) テスト
  - [ ] ウィンドウ作成
  - [ ] IPC登録
  - [ ] アプリライフサイクル

**推定工数**: 2-3日
**期待カバレッジ向上**: +8-12%

### 2.4 UIコンポーネントライブラリ除外調整

- [ ] shadcn/ui コンポーネントを除外設定済み確認
- [ ] カスタマイズしたUIコンポーネントのみテスト対象

---

## 🔒 Phase 3: セキュリティチェック

### 目標
依存関係の脆弱性ゼロ、セキュアなコーディングプラクティス

### 3.1 依存関係セキュリティチェック

- [ ] `pnpm audit` セットアップ
  - [ ] CI/CDに統合
  - [ ] 重要度: HIGH以上でfail設定
- [ ] Dependabot 設定
  - [ ] GitHub Dependabot有効化
  - [ ] 自動PRレビュー設定
- [ ] Snyk または npm audit 統合
  - [ ] セキュリティスキャン自動化

### 3.2 コードセキュリティ

- [ ] ESLint security plugin 導入
  - [ ] `eslint-plugin-security` 検討
  - [ ] または Biome のセキュリティルール確認
- [ ] セキュリティベストプラクティス適用
  - [ ] XSS対策確認（React自動エスケープ）
  - [ ] パストラバーサル対策（IPC file paths）
  - [ ] CSP (Content Security Policy) 設定
  - [ ] Node integration無効化確認

### 3.3 Electron セキュリティチェックリスト

- [ ] [Electron Security Checklist](https://www.electronjs.org/docs/latest/tutorial/security) 全項目確認
  - [ ] Context Isolation 有効
  - [ ] Node Integration 無効
  - [ ] Remote Module 無効
  - [ ] Sandbox 有効
  - [ ] Web Security 有効
  - [ ] 安全なIPC通信

**推定工数**: 2-3日
**優先度**: 🔴 高

---

## 🚀 Phase 4: CI/CD 強化

### 4.1 CI/CD パイプライン改善

- [ ] カバレッジレポート公開
  - [ ] Codecov または Coveralls 統合
  - [ ] PRコメントにカバレッジ差分表示
- [ ] マトリックスビルド拡張
  - [ ] Node.js バージョンマトリックス (20, 22)
  - [ ] OS マトリックス拡張確認
- [ ] キャッシュ最適化
  - [ ] pnpm store キャッシュ
  - [ ] Playwright browsers キャッシュ

### 4.2 プレリリース自動化

- [ ] バージョンタグでの自動ビルド
- [ ] GitHub Releases 自動作成
- [ ] アーティファクト署名（Code signing）検討

**推定工数**: 1-2日
**優先度**: 🟡 中

---

## 📝 Phase 5: ドキュメント整備

### 5.1 開発者向けドキュメント

- [ ] `CONTRIBUTING.md` 作成
  - [ ] 開発環境セットアップ手順
  - [ ] コーディング規約
  - [ ] テスト規約
  - [ ] PR プロセス
- [ ] `ARCHITECTURE.md` 作成
  - [ ] システムアーキテクチャ図
  - [ ] IPC通信フロー
  - [ ] 状態管理戦略
  - [ ] ディレクトリ構造説明
- [ ] API ドキュメント
  - [ ] IPC API リファレンス
  - [ ] コンポーネント Props 一覧

### 5.2 ユーザー向けドキュメント

- [ ] `USER_GUIDE.md` 作成
  - [ ] 機能説明
  - [ ] スクリーンショット
  - [ ] 使い方チュートリアル
- [ ] FAQ 作成

**推定工数**: 2-3日
**優先度**: 🟢 低（リリース前に必要）

---

## 📊 進捗トラッキング

### カバレッジ推移目標

| フェーズ | 目標カバレッジ | 期限 | 状態 |
|---------|--------------|------|------|
| Phase 0 (現在) | 20% | ✅ 2025-11-16 | ✅ 完了 |
| Phase 2.1 | 50% | 未定 | ⏳ 未着手 |
| Phase 2.2 | 65% | 未定 | ⏳ 未着手 |
| Phase 2.3 | 80% | 未定 | ⏳ 未着手 |

### マイルストーン

- [ ] **M1: TypeScript Strict 完了** (Phase 1)
- [ ] **M2: コンポーネントテスト 50%カバレッジ** (Phase 2.1)
- [ ] **M3: セキュリティチェック導入** (Phase 3)
- [ ] **M4: E2Eテスト完了 65%カバレッジ** (Phase 2.2)
- [ ] **M5: 80%カバレッジ達成** (Phase 2.3)
- [ ] **M6: CI/CD オールグリーン** (Phase 4)
- [ ] **M7: ドキュメント完備** (Phase 5)

---

## 🎯 次のアクション

### 推奨開始順序

1. **Phase 1: TypeScript Strict Mode** ← 🎯 最優先
   - 型安全性は全ての品質の基盤
   - 早期に実施するほど手戻りが少ない

2. **Phase 3: セキュリティチェック導入** ← 🎯 次に優先
   - 脆弱性は早期発見が重要
   - CI/CDに組み込んで継続的チェック

3. **Phase 2.1: コンポーネントテスト**
   - カバレッジ最大の向上が期待できる
   - UIの品質向上に直結

4. **Phase 2.2: E2Eテスト**
   - 実際のユーザーフローを検証

5. **Phase 2.3: Main Processテスト**
   - 既に動作しているため優先度は低い

6. **Phase 4: CI/CD強化**
   - 品質が安定してから

7. **Phase 5: ドキュメント**
   - リリース準備時に実施

---

## 📌 補足

- **期限なし**: 焦らず、品質を優先
- **段階的アプローチ**: 1つのフェーズを完了してから次へ
- **CI/CDオールグリーン維持**: 各フェーズで常にグリーンを保つ
- **レビューとリファクタリング**: 必要に応じて既存コードの改善も実施

---

**作成日**: 2025-11-16
**最終更新**: 2025-11-16
**ステータス**: 📋 計画中 → Phase 1 開始準備
