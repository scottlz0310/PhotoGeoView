# PhotoGeoView プロジェクト完全仕様書

## 📋 プロジェクト概要

**PhotoGeoView** は、写真のEXIF情報から撮影場所を抽出し、地図上に表示するPyQt6ベースの写真管理アプリケーションです。モダンなUIとQt-Theme-Manager対応の美しいテーマシステムを特徴とし、写真とその撮影場所を直感的に管理・表示できます。

### 🎯 主要機能

#### 📁 ファイル管理機能
- **フォルダ・ファイル管理**: 画像ファイルのみフィルタリングして表示
- **アドレスバー**: フォルダ選択ボタンで選択、カレントフォルダをテキスト表示
- **ナビゲーション**: フォルダ移動・履歴機能

#### 🖼️ 画像表示・管理機能
- **サムネイル表示**: 写真のサムネイル一覧表示
- **サムネイルサイズ変更**: サムネイルエリアの右クリックでサイズ変更可能
- **画像プレビュー**: 選択した写真の表示、ズーム・パン機能
- **EXIF情報表示**: 撮影日時、カメラ情報、GPS座標等の詳細情報

#### 🗺️ 地図表示機能
- **地図表示**: EXIF位置情報を基にした撮影場所の地図表示
- **地図操作**: ズーム・パン操作が可能
- **撮影位置マーカー**: 写真の撮影場所にマーカー表示

#### 🎨 テーマ・UI機能
- **テーマシステム**: Qt-Theme-Managerで16種類のテーマサポート
- **テーマ切り替え**: トグルボタンで簡単切り替え
- **テーマ設定**: ボタン右クリックでテーマ種類設定可能
- **パネル最大化**: 画像・地図パネルで全画面ボタン設定、戻るボタンで通常表示

## 🏗️ システムアーキテクチャ

### 技術スタック
- **PyQt6**: GUIフレームワーク
- **PyQtWebEngine + Folium**: Leaflet.jsベースの地図表示
- **exifread** : EXIF情報取得
- **Qt-Theme-Manager**: 16種類のテーマ管理

### アーキテクチャ設計
```
📦 PhotoGeoView/
├── 🚀 main.py                         # アプリケーションエントリーポイント
├── 📚 README.md                       # プロジェクト概要・セットアップ
├── 📋 requirements.txt                # Python依存関係定義
├── 🔒 .gitignore                      # Git除外設定
├── 📂 src/                            # ソースコードメイン
│   ├── 🎨 ui/                         # ユーザーインターフェース
│   │   ├── 🏠 main_window.py          # メインウィンドウ実装
│   │   └── 🎭 theme_manager.py        # テーマ管理機能
│   ├── ⚙️ core/                       # コア機能・ユーティリティ
│   │   ├── 🎮 controller.py           # アプリケーション制御ロジック
│   │   ├── ⚙️ settings.py             # 設定管理
│   │   ├── 📝 logger.py               # ログ設定・管理
│   │   └── 🔧 utils.py                # ユーティリティ関数
│   └── 📦 modules/                    # 機能別モジュール
│       ├── 🖼️ image_loader.py         # 画像読み込み機能
│       ├── 🖼️ thumbnail_generator.py  # サムネイル生成機能
│       ├── 📊 exif_parser.py          # EXIFデータ解析
│       ├── 🗺️ map_viewer.py           # 地図表示機能
│       └── 👁️ image_viewer.py         # 画像表示機能
├── ⚙️ config/                         # 設定ディレクトリ
│   ├── 📝 config.json                 # 設定ファイル（永続化含む）
│   └── 📋 logging.json                # ログ設定ファイル
├── 📁 logs/                           # ログ出力ディレクトリ
│   ├── 🐛 debug.log                   # デバッグログ
│   ├── ℹ️ info.log                    # 情報ログ
│   └── ⚠️ error.log                   # エラーログ
├── 🎨 assets/                         # リソースファイル
│   ├── 🎯 icons/                      # アイコン画像
│   └── 🎭 themes/                     # テーマファイル
├── 🧪 tests/                          # テストファイル
│   ├── 🧪 test_exif_parser.py         # EXIF解析テスト
│   ├── 🧪 test_map_viewer.py          # 地図表示テスト
│   └── 🧪 test_image_loader.py        # 画像読み込みテスト
└── 📚 docs/                           # ドキュメント
    ├── 🏗️ architecture.md             # アーキテクチャ設計書
    ├── 📋 Directry_Structure.md       # ディレクトリ構造説明
    ├── 📝 IMPLEMENTATION_PROMPT_FULL.md # 実装仕様詳細
    └── 🎨 PGV-UI.svg                  # UI設計図
```

## 🎨 UI設計・レイアウト

メインウィンドウの各ウィジェットの配置順や比率は`docs/PGV-UI.svg`参照

### メインウィンドウ構成
PhotoGeoView のメインウィンドウは以下の4つの主要エリアで構成されます：

#### 1. 🏠 ヘッダーエリア（上部）
- **アドレスバー**: GIMP風デザイン、フォルダ選択ボタン付き
- **ナビゲーションボタン**: 戻る・進む・上位フォルダ
- **テーマ切り替えボタン**: 右クリックでテーマ選択

#### 2. 📂 左パネル（ファイル管理）
- **フォルダツリー**: ディレクトリ構造表示
- **サムネイルグリッド**: 画像ファイル一覧（右クリックでサイズ変更）
- **詳細情報パネル**: 選択画像のEXIF情報表示

#### 3. 🖼️ 右上パネル（画像プレビュー）
- **メイン画像表示**: ズーム・パン操作対応
- **全画面ボタン**: パネル最大化機能
- **ツールバー**: ズーム操作・回転ボタン

#### 4. 🗺️ 右下パネル（地図表示）
- **インタラクティブ地図**: Folium/Leaflet.jsベース
- **撮影位置マーカー**: GPS情報から自動配置
- **全画面ボタン**: パネル最大化機能

### レスポンシブ設計
- **スプリッター**: パネル間のサイズ調整可能
- **最小サイズ**: 各パネルの最小表示サイズ保証
- **パネル最大化**: 全画面表示と通常表示の切り替え

## 🚀 実装フェーズ計画

### Phase 1: 基盤構築 🏗️
1. **プロジェクト構造構築**
   - ディレクトリ構造作成
   - 基本設定ファイル準備
   - 依存関係インストール

2. **Theme Manager統合**
   - Qt-Theme-Managerライブラリ統合
   - 基本テーマ切り替え機能実装
   - 16種類テーマ設定

3. **メインウィンドウ基盤**
   - PyQt6メインウィンドウ作成
   - 基本レイアウト・スプリッター設定
   - ウィンドウ状態保存・復元

### Phase 2: コアUI実装 🎨
1. **アドレスバー実装**
   - フォルダ選択・ナビゲーション機能
   - カレントアドレスを表示するアドレスバー

2. **左パネル実装**
   - フォルダツリービュー
   - サムネイルグリッド表示
   - 詳細情報パネル

3. **右パネル実装**
   - 画像プレビューウィジェット
   - 地図表示ウィジェット（WebEngine）
   - パネル最大化機能

### Phase 3: 機能実装 ⚙️
1. **画像処理機能**
   - 画像ファイル読み込み・表示
   - サムネイル生成・キャッシュ
   - EXIF情報解析・GPS座標抽出

2. **地図機能**
   - Folium地図生成・表示
   - 撮影位置マーカー配置
   - 地図操作（ズーム・パン）

3. **ナビゲーション機能**
   - フォルダ移動・履歴管理
   - ファイル選択・フィルタリング
   - 設定永続化

### Phase 4: テーマ・UI完成 🎭
1. **16テーマ完全対応**
   - 全テーマでのUI検証
   - テーマ固有スタイル調整
   - ダイナミックテーマ切り替え

2. **UI/UX最適化**
   - アニメーション効果
   - レスポンシブ調整
   - パフォーマンス最適化

3. **エラーハンドリング・テスト**
   - 例外処理・エラー表示
   - ログ機能実装
   - 単体テスト・結合テスト

## 📦 依存関係・要件

### Python依存パッケージ
```txt
# requirements.txt
PyQt6>=6.4.0
PyQt6-WebEngine>=6.4.0
exifread>=3.0.0
folium>=0.14.0
qt-theme-manager>=0.1.0
```

### システム要件
- **Python**: 3.8以上
- **OS**: Windows 10/11, macOS 10.15+, Ubuntu 18.04+
- **メモリ**: 4GB以上推奨
- **ストレージ**: 100MB以上の空き容量

## 🎯 実装時の重要ポイント

### 🎨 Theme Manager活用
- **16種類テーマ**: Dark/Light系統の多様なテーマ
- **動的切り替え**: 再起動不要のテーマ変更
- **コンポーネント別適用**: ウィジェット単位での細かい調整

### ⚡ パフォーマンス最適化
- **非同期処理**: 大量画像読み込み時のUI応答性確保
- **サムネイルキャッシュ**: 高速サムネイル表示
- **メモリ効率**: 大量画像表示時のメモリ管理
- **遅延読み込み**: 必要時のみリソース読み込み

### 🛡️ エラーハンドリング
- **画像読み込みエラー**: 破損ファイル・未対応形式の処理
- **GPS情報なし**: 位置情報がない画像の適切な処理
- **ファイルアクセス権限**: 読み込み権限がないファイルの処理
- **ネットワークエラー**: 地図タイル読み込み失敗時の処理

### 🌍 クロスプラットフォーム対応
- **パス処理統一**: OS固有のパス区切り文字対応
- **フォント互換**: 各OS標準フォント使用
- **アイコン最適化**: 高DPI・Retina画面対応
- **ファイルダイアログ**: OS標準ダイアログ使用

## 🧪 テスト戦略

### テスト構造
- **デバッグファイル**: `tests/`ディレクトリに配置、ルートフォルダには配置しない
- **単体テスト**: 各モジュール個別のテスト
- **結合テスト**: モジュール間連携のテスト
- **UI テスト**: ユーザーインタラクションのテスト

### ロギング・デバッグ要件
- **Logger必須**: 全モジュールでPython標準loggingライブラリ使用
- **print文禁止**: デバッグ・本番環境でのprint()使用は厳禁
- **ログレベル**: DEBUG, INFO, WARNING, ERROR, CRITICALの適切な使い分け
- **ログ出力先**: ファイル・コンソール両対応、設定で切り替え可能
- **ログフォーマット**: タイムスタンプ、ログレベル、モジュール名、メッセージを含む統一形式

### 主要テストケース
1. **画像処理テスト**: 各種画像形式の読み込み・EXIF解析
2. **地図表示テスト**: GPS座標から地図マーカー生成
3. **テーマテスト**: 16種類テーマでのUI表示確認
4. **パフォーマンステスト**: 大量ファイル処理時の動作確認

## 📚 開発ドキュメント

### 設計ドキュメント
- **UI設計図**: `PGV-UI.svg` - インターフェース全体レイアウト
- **アーキテクチャ図**: システム構成と各モジュール関係
- **API仕様**: 各モジュール間のインターフェース定義

### 開発ガイドライン
- **コーディング規約**: PEP 8準拠
- **コメント**: 日本語・英語併記
- **Git管理**: 機能単位でのブランチ・コミット
- **ドキュメント**: Markdown形式での文書化

#### 🚫 禁止事項
- **print文の使用禁止**: デバッグ目的でも`print()`は使用しない
- **ハードコードされたパス**: 絶対パス・環境固有パスの直接記述禁止
- **例外の無視**: `except: pass`のような例外の隠蔽は禁止

#### ✅ 必須実装事項
- **Logger使用**: 全モジュールで適切なログ出力
- **型ヒント**: 全関数・メソッドに型アノテーション
- **Docstring**: 全クラス・関数に適切な説明文

## 🎉 期待される成果

PhotoGeoView は、以下の価値を提供する写真管理アプリケーションとして完成します：

### ✨ ユーザー体験
- **直感的操作**: シンプルで分かりやすいインターフェース
- **高速表示**: 大量写真でもスムーズな動作
- **美しいUI**: 16種類テーマによる個人好みのカスタマイズ
- **情報豊富**: 写真と位置情報の統合表示

### 🔧 技術的価値
- **モダンアーキテクチャ**: PyQt6ベースの最新技術
- **拡張可能設計**: 新機能追加しやすい構造
- **クロスプラットフォーム**: 主要OS全対応
- **高品質コード**: テスト・ドキュメント完備

この仕様書に基づき、**Qt-Theme-Manager**の16種類テーマを活用した美しく機能的なPhotoGeoViewを実装し、ユーザーの写真管理体験を大幅に向上させることができます。
